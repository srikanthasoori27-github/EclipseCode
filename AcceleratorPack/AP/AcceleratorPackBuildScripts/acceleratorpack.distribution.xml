<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright Â© 2018 SailPoint Technologies, Inc. All Rights Reserved.
All logos, text, content, and works of authorship, including but not limited to underlying code, programming or scripting language, designs, and/or graphics,
that are used and/or depicted herein are protected under United States and international copyright and trademark laws and treaties,
and may not be used or reproduced without the prior express written permission of SailPoint Technologies, Inc. -->
<project name="acceleratorpack.distribution">
  <import file="acceleratorpack.java.xml"/>
    <target name="-setupPath">
	   <path id="distribution.compile.classpath">
		<fileset dir="${build.iiqBinaryExtract}/WEB-INF/lib">
	        <include name="**/*.jar"/>
	    </fileset>
	    </path>
    </target>
    <target name="-findLib" depends="-setupPath">
        <if>
            <available file="${build.iiqBinaryExtract}/WEB-INF/lib" type="dir"/>
            <then>
                <echo>Found IdentityIQ Jars ...</echo>
            </then>
            <else>
                <antcall target="-clean"/>
                <antcall target="-iiqBinaries"/>
            </else>
        </if>
    </target>
    <target name="-createJar" depends="-compile, -runTests">
    	<mkdir dir="AcceleratorPackZip/web/WEB-INF/lib"/>
        <copy todir="${build}/classes/META-INF" file="src/faces-config.xml"/>
    	<jar destfile="AcceleratorPackZip/web/WEB-INF/lib/AcceleratorPack.jar" basedir="build/classes"/>
    </target>
	<target name="-copyWeb">
							<copy todir="AcceleratorPackZip/web" overwrite="true">
								    <fileset dir="web">
								    	  <include name="**/*"/>
								    	 <exclude name="**/log4j.properties"/>
								    	 <exclude name="**/Demo*"/>
								    	 <exclude name="**/DemoArtifacts/**"/>
								    </fileset>
								</copy>
	</target>
  <target name="-copyPatchFiles" if="isPatch">
    <!-- patch specific distributables -->
    <copy todir="AcceleratorPackZip/web/WEB-INF/config/patch">
      <fileset dir="src/patch" />
      <filtermapper>
        <replacestring from="${AcceleratorPack.Version}p" to="${AcceleratorPack.Version}${AcceleratorPack.PatchLevel}" />
      </filtermapper>
    </copy>
  </target>
	<target name="-cleanAcceleratorPackZip">
		<delete dir="AcceleratorPackZip"  deleteonexit="true"/>
	</target>
    <target name="-cleanDistribute">
        <delete dir="distribute"  deleteonexit="true"/>
    </target>
   <target name="zipRelease" description="Releases AcceleratorPack in Zip Format" depends="init-properties, -cleanDistribute,-cleanAcceleratorPackZip, -findLib, -createJar, -copyWeb, -copyPatchFiles">
   	<zip destfile="AcceleratorPackRelease/Accelerator_Pack-${AcceleratorPack.Version}${AcceleratorPack.PatchLevel}.zip" basedir="AcceleratorPackZip"/>
    <antcall target="-cleanDistribute"/>
    <antcall target="-cleanAcceleratorPackZip"/>
   </target>
</project>
