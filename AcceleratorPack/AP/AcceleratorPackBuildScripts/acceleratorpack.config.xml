<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright Â© 2018 SailPoint Technologies, Inc. All Rights Reserved.
All logos, text, content, and works of authorship, including but not limited to underlying code, programming or scripting language, designs, and/or graphics,
that are used and/or depicted herein are protected under United States and international copyright and trademark laws and treaties,
and may not be used or reproduced without the prior express written permission of SailPoint Technologies, Inc. -->
<project name="accelerator.pack.config">
   <condition property="windows">
        <os family="windows" />
    </condition>
    <condition property='linux'>
        <os family='unix' name='Linux' />
    </condition>
   <target name="import-all" depends="init-properties" description="Import All Inits">
        <echo>Importing with: console iiqBeans -c "import '${build.iiqBinaryExtract}/WEB-INF/config/init.xml'"</echo>
        <java classname="sailpoint.launch.Launcher" fork="true">
           <arg line="console iiqBeans -u ${importUser} -p ${importPassword} -c &quot;import '${build.iiqBinaryExtract}/WEB-INF/config/init.xml'&quot;"/>
            <classpath>
                <pathelement path="${build.iiqBinaryExtract}/WEB-INF/classes"/>
                <pathelement location="${build.iiqBinaryExtract}/WEB-INF/lib/identityiq.jar"/>
            </classpath>
        </java>
    </target>
    <target name="import-acceleratorpack" >
        <echo>Importing objects with: console iiqBeans -c "import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack.xml'"</echo>
    	 <echo>User :::${importUser} Password::: ${importPassword}</echo>
        <java classname="sailpoint.launch.Launcher" fork="true">
           <arg line="console iiqBeans -u ${importUser} -p ${importPassword} -c &quot;import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack.xml'&quot;"/>
            <classpath>
                <pathelement path="${build.iiqBinaryExtract}/WEB-INF/classes"/>
                <pathelement location="${build.iiqBinaryExtract}/WEB-INF/lib/identityiq.jar"/>
            </classpath>
        </java>
    </target>
	 <target name="import-acceleratorpack-BETA" >
	        <echo>Importing objects with: console iiqBeans -c "import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack-BETA.xml'"</echo>
	    	 <echo>User :::${importUser} Password::: ${importPassword}</echo>
	        <java classname="sailpoint.launch.Launcher" fork="true">
	           <arg line="console iiqBeans -u ${importUser} -p ${importPassword} -c &quot;import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack-BETA.xml'&quot;"/>
	            <classpath>
	                <pathelement path="${build.iiqBinaryExtract}/WEB-INF/classes"/>
	                <pathelement location="${build.iiqBinaryExtract}/WEB-INF/lib/identityiq.jar"/>
	            </classpath>
	        </java>
	    </target>
	 <target name="import-acceleratorpack-epic-BETA" >
		        <echo>Importing objects with: console iiqBeans -c "import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack-epic-BETA.xml'"</echo>
		    	 <echo>User :::${importUser} Password::: ${importPassword}</echo>
		        <java classname="sailpoint.launch.Launcher" fork="true">
		           <arg line="console iiqBeans -u ${importUser} -p ${importPassword} -c &quot;import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack-epic-BETA.xml'&quot;"/>
		            <classpath>
		                <pathelement path="${build.iiqBinaryExtract}/WEB-INF/classes"/>
		                <pathelement location="${build.iiqBinaryExtract}/WEB-INF/lib/identityiq.jar"/>
		            </classpath>
		        </java>
		    </target>
	 <target name="import-acceleratorpack-persona-BETA" >
		        <echo>Importing objects with: console iiqBeans -c "import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack-persona-BETA.xml'"</echo>
		    	 <echo>User :::${importUser} Password::: ${importPassword}</echo>
		        <java classname="sailpoint.launch.Launcher" fork="true">
		           <arg line="console iiqBeans -u ${importUser} -p ${importPassword} -c &quot;import '${build.iiqBinaryExtract}/WEB-INF/config/init-acceleratorpack-persona-BETA.xml'&quot;"/>
		            <classpath>
		                <pathelement path="${build.iiqBinaryExtract}/WEB-INF/classes"/>
		                <pathelement location="${build.iiqBinaryExtract}/WEB-INF/lib/identityiq.jar"/>
		            </classpath>
		        </java>
		    </target>
    <target name="runUpgrade">
        <echo>running patch command for ${IIQVersion}${IIQPatchLevel}</echo>
        <java classname="sailpoint.launch.Launcher" fork="true">
            <arg line="patch ${IIQVersion}${IIQPatchLevel}"/>
            <classpath>
                <pathelement path="${build.iiqBinaryExtract}/WEB-INF/classes"/>
                <pathelement location="${build.iiqBinaryExtract}/WEB-INF/lib/identityiq.jar"/>
            </classpath>
        </java>
    </target>
    <target name="build-inits" depends="validateXML">
        <if>
            <not>
                <resourceexists>
                    <file file="${build.iiqBinaryExtract}/WEB-INF/config/init-default-move.xml"/>
                </resourceexists>
            </not>
            <then>
                <move file="${build.iiqBinaryExtract}/WEB-INF/config/init.xml"
                      tofile="${build.iiqBinaryExtract}/WEB-INF/config/init-default-move.xml" failonerror="true"/>
            </then>
        </if>
        <echo message="IMPORT INIT,INIT-LCM,INIT-PAM,INIT-ACCELERATORPACK"/>
        <build-init initFile="${build.iiqBinaryExtract}/WEB-INF/config/init.xml">
            <fileset dir="${build.iiqBinaryExtract}/WEB-INF/config">
                <include name="init-default-move.xml"/>
                <include name="init-lcm.xml"/>  
                <include name="patch/*.xml"/>
                <include name="init-acceleratorpack.xml"/>
            	<include name="init-pam.xml"/>
                <exclude name="**/*.hbm.xml"/>
            </fileset>
        </build-init>
    </target>
    <target name="-copyIIQFile" depends="build-inits">
      <!-- use a custom iiq properties file for a target -->
      <copy file="iiq.properties" tofile="${build.iiqBinaryExtract}/WEB-INF/classes/iiq.properties" failonerror="false" overwrite="true"/>
    </target>
    <!-- ********************************************************** -->
    <!-- Target: strip-ids                                          -->
    <!-- Strip out id modified and created tags from custom xml     -->
    <!-- ********************************************************** -->
    <target name="-strip-ids">
        <echo message="Removing hibernate object attributes from xml files"/>
        <replaceregexp flags="g">
            <regexp pattern="\s(id|created|modified)=[&quot;']\w+[&quot;']"/>
            <substitution expression=""/>
            <fileset dir="${build.acceleratorPackXMLDir}">
                <include name="**/*.xml"/>
                <!--<exclude name="**/${init-file}" />-->
				<exclude name="**/Identity/*.xml"/>        
				<exclude name="**/IdentityArchive/*.xml"/>
            </fileset>
        </replaceregexp>
    </target>
    <!-- ********************************************************** -->
    <!-- Target: validate                                           -->
    <!-- Validate custom XML files                                  -->
    <!-- ********************************************************** -->
    <target name="validateXML" depends="init-properties,-strip-ids" description="DTD Validation AcceleratorPack XML Files">
        <echo message="DTD Validation"/>
        <xmlvalidate>
            <fileset dir="${build.acceleratorPackXMLDir}" includes="**/*.xml"/>
            <xmlcatalog>
                <dtd publicId="sailpoint.dtd" location="${dtd}"/>
            </xmlcatalog>
        </xmlvalidate>
    </target>
</project>