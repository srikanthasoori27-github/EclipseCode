<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Workflow PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<!-- Copyright Â© 2018 SailPoint Technologies, Inc. All Rights Reserved.
All logos, text, content, and works of authorship, including but not limited to underlying code, programming or scripting language, designs, and/or graphics,
that are used and/or depicted herein are protected under United States and international copyright and trademark laws and treaties,
and may not be used or reproduced without the prior express written permission of SailPoint Technologies, Inc. -->
<Workflow explicitTransitions="true" name="Workflow-Lifecycle-Mover" type="IdentityLifecycle">
 <Description>Accelerator Pack Mover Workflow</Description>
  <Variable input="true" name="trigger">
    <Description>The IdentityTrigger</Description>
  </Variable>
  <Variable input="true" name="event" transient="true">
     <Description>
      The IdentityChangeEvent.  It can be used to build
      the provisioning plan, but does not need to be
      persisted with the case, so marked as transient.
    </Description>
  </Variable>
  <Variable initializer="false" name="trace">
    <Description>
      Used for debugging this workflow and when set to true trace
      will be sent to stdout.
    </Description>
  </Variable>
  <Variable input="true" name="identityName">
    <Description>The name of the identity.</Description>
  </Variable>
   <Variable input="true" name="launcher">
    <Description>Launcher</Description>
  </Variable>
  <Variable name="flow" initializer="Lifecycle">
    <Description>The name of the identity.</Description>
  </Variable>
  <Variable name="source" initializer="string:LCM">
    <Description>The name of the identity.</Description>
  </Variable>
  <Variable initializer="script:resolveDisplayName(identityName)" input="true" name="identityDisplayName">
    <Description>
      The displayName of the identity being updated.
      Query for this using a projection query and fall back to the name.
    </Description>
  </Variable>
  <Variable editable="true" name="requestType">
  </Variable>
  <RuleLibraries>
    <Reference class="sailpoint.object.Rule" name="Rule-Mover-RuleLibrary"/> 
  </RuleLibraries>
  <Step icon="Start"  name="Start" posX="28" posY="10" >
    <Transition to="Get Request Type"/>
  </Step>
  <Step  name="Get Request Type" posX="98" posY="10" resultVariable="requestType">
    <Script>
      <Source>
      	return getRequestTypeName(context, workflow);
      </Source>
    </Script>
    <Transition to="Launch Mover" />
  </Step>
  <Step name="Launch Mover" posX="374" posY="10" >
    <Script>
      <Source>
      	startMoverProcess( context,  identityName,  workflow,  flow,  requestType, launcher);
     	</Source>
    </Script>
    <Transition to="Execute Post Joiner"/>
  </Step>
  <Step name="Execute Post Joiner" >
    <Script>
      <Source>
      import sailpoint.rapidapponboarding.rule.JoinerRuleLibrary;
   	  postJoiner( context,identityName, workflow, flow, JoinerRuleLibrary.JOINERFEATURE);
  	</Source>
    </Script>
   <Transition to="Execute Mover Post Rule" />
  </Step>
    <Step name="Execute Mover Post Rule" >
    <Script>
      <Source>
      postMoverRule( identityName,  requestType);
  	</Source>
    </Script>
   <Transition to="Stop" />
  </Step>
 <Step icon="Stop" name="Stop" posX="1060" posY="10"/> 
</Workflow>
