<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
  "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
  "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd" [
  <!ENTITY IndexBase "spt_taskres">
  <!ENTITY SailPointObject SYSTEM "classpath://sailpoint/object/SailPointObject.hbm.xml">
  <!ENTITY TaskItem SYSTEM "classpath://sailpoint/object/TaskItem.hbm.xml">
]>

<!-- (c) Copyright 2008 SailPoint Technologies, Inc., All Rights Reserved. -->

<hibernate-mapping>
  <!-- Note the use of polymorphism="explicit", PartitionResult is a subclass
       starting in 6.3 and we don't want Hiberntate including those in
       TaskResult.class queries -->
  <class name="sailpoint.object.TaskResult" polymorphism="explicit">

    &TaskItem;

    <!-- completed moved from TaskItem in 7.0 so it can be selectively indexed
         see bug 24184 -->
    <property name="completed" type="sailpoint.persistence.DateType"
              index="spt_taskres_completed"/>

    <property name="expiration" type="sailpoint.persistence.DateType" 
              index="spt_taskres_expiration"/>

    <property name="verified" type="sailpoint.persistence.DateType" 
              index="spt_taskres_verified"/>

    <!-- not yet, need to reconcile with Certification.signed
    <property name="signed" type="sailpoint.persistence.DateType"/>
    -->

    <!-- 
      This has historically had a unique name, though its kind of a pain.
      Request doesn't.  This should be consistent with WorkflowCase.name
      and by extension ProcessLog.workflowCaseName, the later is indexed
      so it has a max of 450.  
      Actually unique columns in MySQL reserves 3 bytes per character
      with a maximum of 767 bytes the maximum character count is 255.
    -->
    <property name="name" type="string" length="255" unique="true" not-null="true"/>

    <many-to-one embed-xml="false" name="definition" class="sailpoint.object.TaskDefinition"/>

    <!-- Apparently the Task Schedule page searches for results by schedule name
         and sorts them by completion date, so index it.  This will never be
         typed in by the user so it doesn't need to be case insensntive -->
    <property name="schedule" index="spt_taskresult_schedule"/>

    <property name="pendingSignoffs"/>
    <property name="signoff" type="sailpoint.persistence.XmlType" length="100000000"/>

    <!-- This is really a one-to-one, is this the right mapping?
         !! Probably want to cascade="all" here, the JasperReports
         aren't accessible on their own.
      -->
    <many-to-one embed-xml="false" name="report" class="sailpoint.object.JasperResult"/>

    <property name="targetClass"/>
    <property name="targetId" index="spt_taskresult_target"/>
    <property name="targetName" index="spt_taskresult_targetname_ci"/>

    <property name="terminated" column="task_terminated" type="boolean" />
    <property name="partitioned" type="boolean" />
    <property name="live" type="boolean" />

    <property name="completionStatus" index="spt_task_compl_status">
      <type name="sailpoint.persistence.EnumType">
        <param name="enumClassName">sailpoint.object.TaskResult$CompletionStatus</param>
      </type>
    </property>

    <property name="runLength"/>
    <property name="runLengthAverage"/>
    <property name="runLengthDeviation"/>

  </class>
</hibernate-mapping>
