<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
  "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
  "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd" [
  <!ENTITY SailPointObject SYSTEM "classpath://sailpoint/object/SailPointObject.hbm.xml">
  <!ENTITY BundleExtensions SYSTEM "classpath://sailpoint/object/BundleExtended.hbm.xml">
  <!ENTITY RoleScorecard SYSTEM "classpath://sailpoint/object/RoleScorecard.hbm.xml">
  <!ENTITY Classifiable SYSTEM "classpath://sailpoint/object/Classifiable.hbm.xml">
]>

<!-- (c) Copyright 2008 SailPoint Technologies, Inc., All Rights Reserved. -->

<hibernate-mapping>
  <class name="sailpoint.object.Bundle">

    &SailPointObject;
    &BundleExtensions;
    &Classifiable;

    <property name="name" type="string" length="128" unique="true" not-null="true"/>
    <property name="displayName" type="string" length="128"/>
    <property name="displayableName" type="string" length="128" index="spt_bundle_dispname_ci"/>
    <property name="disabled" type="boolean" index="spt_bundle_disabled"/>
    <property name="riskScoreWeight"/>
    <property name="activityConfig" type="sailpoint.persistence.XmlType" length="100000000"/>
    <property name="miningStatistics" type="sailpoint.persistence.XmlType" length="100000000"/>
    <property name="attributes" type="sailpoint.persistence.XmlType" length="100000000"/>
    <property name="type" type="string" length="128" index="spt_bundle_type"/>
    <many-to-one embed-xml="false" name="joinRule" class="sailpoint.object.Rule"/>

    <!-- technically a one-to-one but I don't want to cascade -->
    <many-to-one embed-xml="false" name="pendingWorkflow" class="sailpoint.object.WorkflowCase"/>
    
    <many-to-one embed-xml="false" name="roleIndex" class="sailpoint.object.RoleIndex"
      cascade="all"/>

    <property name="selector" type="sailpoint.persistence.XmlType" 
      length="100000000"/>

    <property name="provisioningPlan" type="sailpoint.persistence.XmlType" 
      length="100000000"/>

    <property name="xmlTemplates" column="templates" type="sailpoint.persistence.XmlType" 
      length="100000000"/>

    <property name="hibernateProvisioningForms" column="provisioningForms" type="sailpoint.persistence.XmlType"
      length="100000000"/>

    <!-- historically this has been named "children" and I don't want to mess
         with upgrading the table names at this point
     -->
    <list name="inheritance" table="BundleChildren"
          cascade="persist,merge,save-update">
      <key column="bundle"/>
      <list-index column="idx"/>
      <many-to-many column="child" class="sailpoint.object.Bundle"/>
    </list>

    <list name="requirements" table="BundleRequirements"
          cascade="persist,merge,save-update">
      <key column="bundle"/>
      <list-index column="idx"/>
      <many-to-many column="child" class="sailpoint.object.Bundle"/>
    </list>

    <list name="permits" table="BundlePermits"
          cascade="persist,merge,save-update">
      <key column="bundle"/>
      <list-index column="idx"/>
      <many-to-many column="child" class="sailpoint.object.Bundle"/>
    </list>

    <list name="profiles" cascade="all">
      <key column="bundleId"/>
      <list-index column="idx"/>
      <one-to-many class="sailpoint.object.Profile"/>
    </list>

    <property name="orProfiles" type="boolean" />

    <property name="activationDate" type="sailpoint.persistence.DateType"/>
    <property name="deactivationDate" type="sailpoint.persistence.DateType"/>

    <many-to-one embed-xml="false" name="scorecard" class="sailpoint.object.RoleScorecard" cascade="all"/>

    <property name="pendingDelete" type="boolean"/>

    <bag name="associations" inverse="true">
      <key column="objectId" foreign-key="none"/>
      <one-to-many class="sailpoint.object.TargetAssociation"/>
    </bag>

  </class>
</hibernate-mapping>
